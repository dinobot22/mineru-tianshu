# ============================================================================
# Tianshu (天枢) - 环境变量配置示例
# ============================================================================
#
# 使用方式：
#   1. 复制此文件为 .env: cp .env.example .env
#   2. 根据实际情况修改配置
#   3. 使用 docker-compose up -d 启动服务
#
# ============================================================================
MINERU_TIANSHU_ENV_LOADED=true # 标志位, 表示环境变量已加载, 无需修改

# 应用基础配置
# ----------------------------------------------------------------------------
API_PORT=8000 # 后端 API 端口, [重要: 该端口负责前端请求响应, 如修改该端口, 则前端部分需要相应修改]
WORKER_PORT=8001 # 后端 Worker 端口
MCP_PORT=8002  # 后端 MCP 端口
FRONTEND_PORT=80 # 前端端口
LOG_LEVEL=INFO # 日志级别（DEBUG, INFO, WARNING, ERROR, CRITICAL）

# 文件上传限制配置
# ----------------------------------------------------------------------------
MAX_FILE_SIZE=0 # 最大文件大小（字节，0 表示不限制）
NGINX_CLIENT_MAX_BODY_SIZE=0 # Nginx 文件上传大小限制（0 表示不限制）

# PDF 拆分功能配置（大文件并行处理）
# ----------------------------------------------------------------------------
PDF_SPLIT_ENABLED=true  # 是否启用 PDF 自动拆分（true/false）
PDF_SPLIT_THRESHOLD_PAGES=500  # PDF 拆分阈值（页数）, 超过此页数的 PDF 会自动拆分为多个子任务并行处理,建议值: 500-1000
PDF_SPLIT_CHUNK_SIZE=250 # PDF 拆分块大小（页数,每个子任务处理的页数,建议值: 300-500 页（根据服务器内存调整）

# 文件存储配置
# ----------------------------------------------------------------------------
BACKEND_APP_DATA_ROOT_PATH="./app_data"  # 后端运行时产生的所有文件根目录
# 默认输出目录(OUTPUT_PATH): 如不设置该配置,默认为 ${BACKEND_APP_DATA_ROOT_PATH}/mineru_tianshu_output
# OUTPUT_PATH="./app_data/mineru_tianshu_output"
# 默认数据库路径: 如不设置该配置,默认为 ${BACKEND_APP_DATA_ROOT_PATH}/mineru_tianshu.db
# DATABASE_PATH="./app_data/mineru_tianshu.db"

# JWT 认证配置
# ----------------------------------------------------------------------------
# 重要：生产环境请修改为随机字符串！
# 生成方式: openssl rand -hex 32
JWT_SECRET_KEY=your-secret-key-change-in-production
JWT_ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=30

# CORS 配置
# ----------------------------------------------------------------------------
ALLOWED_ORIGINS=http://localhost:5173,http://localhost:80


# GPU 配置
# ----------------------------------------------------------------------------
# GPU 数量（Docker 分配）
GPU_COUNT=1 # 非容器化启动时,该参数可以忽略

# 可见的 GPU 设备（Backend，逗号分隔）
CUDA_VISIBLE_DEVICES=0  # 如有多个 GPU, 用逗号分隔, 例如: 0,1,2,3 [重要: 如需要使用多张 GPU, 请修改该配置]

# 每个 GPU 的 Worker 数量
WORKER_GPUS=2  # [重要: 配置每个 GPU 上的 Worker 数量, 建议值: 24G显存: 2 ]

# Worker 批处理大小
MAX_BATCH_SIZE=4

# Worker 超时时间（秒）
WORKER_TIMEOUT=300

# Worker 内存限制（硬限制，超过此值容器会被 OOM Killer 杀死）
# 格式: 数字 + 单位（M/G），例如: 8G, 16G, 32G
# 建议根据服务器内存配置：
#   - 16GB 服务器: 8G
#   - 32GB 服务器: 16G
#   - 64GB 服务器: 32G
WORKER_MEMORY_LIMIT=16G

# Worker 内存软限制（保证最少可用内存）
# 建议设置为硬限制的 50-75%
WORKER_MEMORY_RESERVATION=8G


# 模型下载配置
# ----------------------------------------------------------------------------
# 模型下载源: modelscope (国内推荐) | huggingface | auto
MODEL_DOWNLOAD_SOURCE=auto
# HuggingFace 镜像地址（国内加速）
HF_ENDPOINT=https://hf-mirror.com
# MinerU 虚拟显存大小（GB，auto 表示自动检测）
# MINERU_VIRTUAL_VRAM_SIZE=6


# RustFS 对象存储配置（必须配置）
# ----------------------------------------------------------------------------
# RustFS 服务地址配置:
    # 容器内部模式: rustfs:9000
    # 本地宿主机启动模式: 0.0.0.0:9000
RUSTFS_ENDPOINT=0.0.0.0:9000 # [重要: 需要根据实际启动模式修改]

# RustFS 访问密钥（生产环境请修改！）
RUSTFS_ACCESS_KEY=rustfsadmin
RUSTFS_SECRET_KEY=rustfsadmin

# RustFS 存储桶名称
RUSTFS_BUCKET=ts-img

# RustFS 是否使用 HTTPS
RUSTFS_SECURE=false

# RustFS 公开访问 URL（外部访问地址，必须配置！）
#
# ⚠️  重要：必须设置为外部可访问的完整 URL
# ❌ 不要使用: http://localhost:9000, http://127.0.0.1:9000, http://172.x.x.x:9000
# ✅ 使用示例:
#    - 局域网: RUSTFS_PUBLIC_URL=http://192.168.1.100:9000
#    - 公网: RUSTFS_PUBLIC_URL=http://your-domain.com:9000
#    - HTTPS: RUSTFS_PUBLIC_URL=https://files.your-domain.com
#    - Windows/WSL: 使用 Windows 主机的 IP (在 Windows 中运行 ipconfig 查看)
#
# 获取 Windows IP 的方法:
#   1. 在 Windows PowerShell 或 CMD 中运行: ipconfig
#   2. 找到 "IPv4 地址"，例如: 192.168.1.100
#   3. 设置: RUSTFS_PUBLIC_URL=http://192.168.1.100:9000
#
RUSTFS_PUBLIC_URL=http://localhost:9000 # [重要: 需要根据实际启动模式修改]

# RustFS 服务端口(docker 模式下生效)
RUSTFS_PORT=9000 # 非docker模式下, 该配置无需修改
RUSTFS_CONSOLE_PORT=9001 # 非docker模式下, 该配置无需修改


# MCP Server 配置（可选）
# ----------------------------------------------------------------------------
API_URL=http://backend:8000

# 前端配置
# ----------------------------------------------------------------------------
# VITE_API_BASE_URL=http://localhost:8000
